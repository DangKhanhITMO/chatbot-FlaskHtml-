<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Chatbot AI GPET</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Merriweather&family=Quicksand&display=swap" rel="stylesheet">

    <!-- ✅ Thêm thư viện Markdown và MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['\\(', '\\)']],
          displayMath: [['\\[', '\\]']]
        },
        svg: { fontCache: 'global' }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

    <style>
        body {
          font-family: 'Quicksand', sans-serif;
          background: url('img1.jpg') no-repeat center center fixed;
          background-size: cover;
          margin: 0;
          padding: 1rem 0;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        h1 {
          font-family: 'Pacifico', cursive;
          font-size: 3rem;
          font-weight: 800;
          color: #fff;
          text-align: center;
          text-shadow:
            2px 2px 6px rgba(0, 0, 0, 0.7),
            0 0 10px rgba(255, 255, 255, 0.4);
          margin-bottom: 1.5rem;
        }

        .container {
          display: flex;
          width: 95vw;
          max-width: 1400px;
          gap: 2rem;
          padding: 0 1vw;
          box-sizing: border-box;
          margin: auto;
        }

        .left-panel, .right-panel {
          flex: 1;
          background: rgba(255, 255, 255, 0.95);
          border-radius: 12px;
          padding: 1.5rem;
          box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .left-panel h2 {
          font-size: 1.3rem;
          margin-bottom: 1rem;
        }

        .feature {
          background: #e0f7fa;
          padding: 1rem;
          border-radius: 8px;
          margin-bottom: 1rem;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          font-weight: bold;
          color: #00796b;
        }

        .right-panel {
          display: flex;
          flex-direction: column;
          height: 600px;
        }

        .chat-box {
          flex: 1;
          overflow-y: auto;
          margin-bottom: 1rem;
        }

        .message {
          display: flex;
          align-items: flex-start;
          margin: 1rem 0;
          opacity: 1;
          transform: translateY(0);
          transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .message.bot.fade-in {
          opacity: 0;
          transform: translateY(20px);
        }

        .message.bot.fade-in.show {
          opacity: 1;
          transform: translateY(0);
        }

        .user {
          justify-content: flex-end;
          flex-direction: row-reverse;
        }

        .bot {
          justify-content: flex-start;
        }

        .avatar {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          margin: 0 0.5rem;
          object-fit: cover;
          box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        .bubble {
          max-width: 70%;
          padding: 0.7rem 1rem;
          border-radius: 16px;
          line-height: 1.5;
          position: relative;
        }

        .timestamp {
          font-size: 0.75rem;
          color: #666;
          margin-top: 0.3rem;
          text-align: right;
        }

        .user .bubble {
          background-color: #d0ebff;
          color: #003366;
          text-align: right;
        }

        .bot .bubble {
          background-color: #e6ffe6;
          color: #1b4d1b;
          font-family: 'Merriweather', serif;
        }

        .input-area {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        textarea {
          flex: 1;
          padding: 0.8rem;
          border-radius: 8px;
          border: 1px solid #ccc;
          font-size: 1rem;
          resize: none;
        }

        button {
          padding: 0.8rem 1.2rem;
          background-color: #3399ff;
          color: white;
          font-weight: bold;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.3s ease;
        }

        button:hover {
          background-color: #1a75d1;
        }

        @media (max-width: 768px) {
          .container {
            flex-direction: column;
            width: 95vw;
            padding: 0.5rem;
          }

          h1 {
            font-size: 2rem;
            padding: 0 1rem;
          }
        }
    </style>
</head>
<body>
<h1>Dịch vụ khám và tư vấn chăm sóc thú cưng tự động của GPET</h1>

<div class="container">
    <!-- Left Panel -->
    <div class="left-panel">
        <h2>Chức năng sẽ phát triển trong tương lai</h2>
        <div class="feature">Chức năng 1: Đặt lịch khám online</div>
        <div class="feature">Chức năng 2: Theo dõi sức khỏe định kỳ</div>
        <div class="feature">Chức năng 3: Tư vấn dinh dưỡng</div>
        <div class="feature">Chức năng 4: Giao thuốc tận nhà</div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
        <div class="chat-box" id="chat-box"></div>
        <div class="input-area">
            <textarea id="user-input" rows="2" placeholder="Nhập tin nhắn..."></textarea>
            <button onclick="sendMessage()">Gửi</button>
        </div>
    </div>
</div>

<script>
    function getTimeNow() {
      const now = new Date();
      return now.getHours().toString().padStart(2, '0') + ':' +
             now.getMinutes().toString().padStart(2, '0');
    }

    function appendUserMessage(message) {
      const chatBox = document.getElementById("chat-box");
      const timestamp = getTimeNow();
      chatBox.innerHTML += `
        <div class="message user">
          <img src="img3.png" alt="User" class="avatar"/>
          <div class="bubble">
            ${message}
            <div class="timestamp">${timestamp}</div>
          </div>
        </div>
      `;
    }

    function appendBotMessage(replyMarkdown) {
      const chatBox = document.getElementById("chat-box");
      const timestamp = getTimeNow();

      const htmlContent = marked.parse(replyMarkdown);

      const wrapper = document.createElement('div');
      wrapper.className = 'message bot fade-in';
      wrapper.innerHTML = `
        <img src="img2.png" alt="Bot" class="avatar"/>
        <div class="bubble">
          ${htmlContent}
          <div class="timestamp">${timestamp}</div>
        </div>
      `;

      chatBox.appendChild(wrapper);
      setTimeout(() => wrapper.classList.add('show'), 50);

      MathJax.typesetPromise();
    }

    async function sendMessage() {
      const input = document.getElementById("user-input");
      const chatBox = document.getElementById("chat-box");
      const message = input.value.trim();
      if (!message) return;

      appendUserMessage(message);
      input.value = "";
      input.focus();

      try {
        const response = await fetch("https://drusilla-dauby-undefinitively.ngrok-free.dev/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ message })
        });

        const data = await response.json();
        const reply = data.reply || 'Đã xảy ra lỗi!';
        appendBotMessage(reply);
      } catch (e) {
        appendBotMessage("Không thể kết nối với máy chủ!");
      }

      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendWelcomeMessage() {
      try {
        const response = await fetch("https://drusilla-dauby-undefinitively.ngrok-free.dev/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ message: "" })
        });

        const data = await response.json();
        if (data.reply) {
          appendBotMessage(data.reply);
        }
      } catch (e) {
        appendBotMessage("Không thể kết nối để lấy lời chào!");
      }
    }

    window.onload = () => {
      document.getElementById("user-input").focus();
      sendWelcomeMessage();
    };
</script>
</body>
</html>